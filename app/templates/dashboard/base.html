<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Dashboard - ODiGO{% endblock %}</title>

    <!-- Compiled Tailwind CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/print.css') }}" media="print">

    <!-- Custom Styles -->
    <style>
        .glass-effect {
            backdrop-filter: blur(10px);
        }

        .floating-animation {
            animation: float 6s ease-in-out infinite;
        }

        .floating-animation-delayed {
            animation: float 6s ease-in-out infinite 2s;
        }

        .floating-animation-slow {
            animation: float 8s ease-in-out infinite 1s;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        .line-clamp-1 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            line-clamp: 1;
            -webkit-box-orient: vertical;
        }

        .line-clamp-2 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        /* Sidebar styling */
        .sidebar-transition {
            transition: transform 0.3s ease-in-out;
        }

        .sidebar-hidden {
            transform: translateX(-100%);
        }

        .sidebar-visible {
            transform: translateX(0);
        }

        /* Ensure sidebar takes full height */
        #sidebar {
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            width: 16rem;
            /* 64 * 0.25rem = 16rem */
            overflow-y: auto;
            z-index: 30;
        }

        @media (min-width: 1024px) {
            #sidebar {
                position: fixed;
                transform: translateX(0) !important;
            }
        }

        @media (max-width: 1023px) {
            #sidebar {
                position: fixed;
                transform: translateX(0);
            }

            #sidebar.sidebar-hidden {
                transform: translateX(-100%);
            }
        }

        /* Navigation link styling with proper flex alignment */
        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            /* 12px gap between icon and text */
            padding: 0.75rem 1rem;
            color: #e0e7ff;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.875rem;
            line-height: 1.25rem;
        }

        .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            text-decoration: none;
        }

        .nav-link svg {
            width: 1.25rem;
            /* 20px */
            height: 1.25rem;
            /* 20px */
            flex-shrink: 0;
            stroke-width: 2;
        }

        .nav-link.active {
            background-color: rgba(255, 255, 255, 0.2);
            color: #ffffff;
            border-left: 3px solid #ffffff;
        }

        /* Main content adjustment */
        .main-content {
            margin-left: 16rem;
            height: 100vh;
            overflow-y: auto;
            /* Same as sidebar width */
        }

        @media (max-width: 1023px) {
            .main-content {
                margin-left: 0;
            }
        }

        /* Feature card style from landing page */
        .feature-card {
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .feature-card:hover {
            transform: translateY(-8px) scale(1.05);
        }
    </style>
</head>

<body class="min-h-screen bg-gray-50 text-gray-800 h-screen overflow-hidden">
    <!-- Animated background elements -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div
            class="absolute -top-20 -right-20 w-40 h-40 bg-indigo-500 rounded-full mix-blend-multiply filter blur-xl opacity-10 floating-animation">
        </div>
        <div
            class="absolute -bottom-20 -left-20 w-60 h-60 bg-purple-400 rounded-full mix-blend-multiply filter blur-xl opacity-10 floating-animation-delayed">
        </div>
        <div
            class="absolute top-1/3 left-1/4 w-32 h-32 bg-green-300 rounded-full mix-blend-multiply filter blur-xl opacity-10 floating-animation-slow">
        </div>
        <div
            class="absolute bottom-1/3 right-1/4 w-48 h-48 bg-blue-200 rounded-full mix-blend-multiply filter blur-xl opacity-10 floating-animation">
        </div>
    </div>

    <!-- Flash messages -->
    <div id="flash-messages"
        class="fixed top-6 left-1/2 transform -translate-x-1/2 z-50 space-y-2 w-full max-w-md px-4">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="rounded-xl p-4 text-sm font-medium text-white
                        {% if category == 'success' %}bg-green-600{% elif category == 'error' %}bg-red-600{% elif category == 'warning' %}bg-yellow-500{% else %}bg-indigo-600{% endif %}
                        transform transition-all duration-300 ease-out">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}
    </div>

    <div class="flex min-h-screen ">
        <!-- Sidebar -->
        <div id="sidebar"
            class="fixed lg:fixed w-64 bg-gradient-to-b from-indigo-600 to-indigo-800 border-r border-indigo-500 z-30 sidebar-transition sidebar-visible inset-y-0 left-0"
            style="height: 100vh; min-height: 100vh;">
            <div class="h-full flex flex-col p-6">
                <!-- Logo -->
                <div class="flex items-center mb-8">
                    <div class=" rounded-full p-2 mr-3">
                        <img width="32px" height="32px" src="{{ url_for('static', filename='brand/logo.png') }}"
                            alt="ODiGO">
                    </div>
                    <h1 class="text-xl font-bold text-white">ODiGO</h1>
                </div>

                <!-- User Profile -->
                <div class="bg-gradient-to-r from-indigo-400 to-indigo-500 rounded-xl p-4 mb-6">
                    <div class="flex items-center">
                        <div
                            class="bg-gradient-to-r from-white to-indigo-100 rounded-full w-12 h-12 flex items-center justify-center text-indigo-600 font-semibold mr-3">
                            {{ (current_user.name or 'U')[0].upper() }}
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium text-white truncate">{{ current_user.name or 'Chef' }}</p>
                            <p class="text-xs text-indigo-200 truncate">{{ current_user.email }}</p>
                        </div>
                    </div>
                </div>

                <!-- Navigation -->
                <nav class="flex-1 mb-8" style="margin-bottom: 2rem;">
                    <div style="margin-bottom: 0.5rem;">
                        <a href="{{ url_for('dashboard.index') }}"
                            class="nav-link {% if request.endpoint == 'dashboard.index' %}active{% endif %}">
                            <i class="fa-solid fa-house"></i>
                            Dashboard
                        </a>
                    </div>

                    <div style="margin-bottom: 0.5rem;">
                        <a href="{{ url_for('dashboard.my_recipes') }}"
                            class="nav-link {% if request.endpoint == 'dashboard.my_recipes' %}active{% endif %}">
                            <i class="fa-solid fa-book-bookmark"></i>
                            My Recipes
                        </a>
                    </div>

                    <div style="margin-bottom: 0.5rem;">
                        <a href="{{ url_for('dashboard.explore') }}"
                            class="nav-link {% if request.endpoint == 'dashboard.explore' %}active{% endif %}">
                            <i class="fa-solid fa-compass"></i>
                            Explore Recipes
                        </a>
                    </div>

                    <div style="margin-bottom: 0.5rem;">
                        <a href="{{ url_for('dashboard.add_recipe') }}"
                            class="nav-link {% if request.endpoint == 'dashboard.add_recipe' %}active{% endif %}">
                            <i class="fa-solid fa-plus"></i>
                            Add Recipe
                        </a>
                    </div>

                    <div style="margin-bottom: 0.5rem;">
                        <a href="{{ url_for('planner.index') }}" class="nav-link {% if request.endpoint.startswith('planner.') %}active{% endif %}">
                            <i class="fa-solid fa-calendar-days"></i>
                            Meal Planner
                        </a>
                    </div>

                    <div style="margin-bottom: 0.5rem;">
                        <a href="{{ url_for('community.feed') }}" class="nav-link {% if request.endpoint.startswith('community.') %}active{% endif %}">
                            <i class="fa-solid fa-users"></i>
                            Community Feed
                        </a>
                    </div>
                </nav>

                <!-- Bottom Actions -->
                <div style="padding-top: 1rem; border-top: 1px solid #e5e7eb;">
                    <div style="margin-bottom: 0.5rem;">
                        <a href="#" class="nav-link">
                            <i class="fa-solid fa-gear"></i>
                            Settings
                        </a>
                    </div>

                    <div style="margin-bottom: 0.5rem;">
                        <a href="{{ url_for('auth.logout') }}" class="nav-link" style="color: #fca5a5;">
                            <i class="fa-solid fa-right-from-bracket"></i>
                            Logout
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 main-content">
            <!-- Top Bar -->
            <div class="bg-white border-b border-gray-200 px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <!-- Mobile menu button -->
                        <button id="mobile-menu-btn"
                            class="lg:hidden xl:hidden p-2 rounded-md text-gray-600 hover:text-gray-800 hover:bg-gray-100 mr-4">
                            <i class="fa-solid fa-bars"></i>
                        </button>

                        <h2 class="text-lg font-semibold text-gray-800">
                            {% block page_title %}
                            {% if request.endpoint == 'dashboard.index' %}Dashboard
                            {% elif request.endpoint == 'dashboard.my_recipes' %}My Recipes
                            {% elif request.endpoint == 'dashboard.explore' %}Explore Recipes
                            {% else %}ODiGO{% endif %}
                            {% endblock %}
                        </h2>
                    </div>

                    <div class="flex items-center space-x-4">
                        <!-- Search (for larger screens) -->
                        <div class="hidden md:block relative">
                            <input type="text" placeholder="Search recipes..."
                                class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 w-64">
                            <i class="fa-solid fa-magnifying-glass w-5 h-5 text-gray-400 absolute left-3 top-2.5"></i>
                        </div>

                        <!-- Notifications -->
                        <button class="p-2 rounded-full text-gray-600 hover:text-gray-800 hover:bg-gray-100 relative">
                            <i class="fa-solid fa-bell"></i>
                            <span class="absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"></span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Page Content -->
            <div class="p-6">
                {% block dashboard_content %}{% endblock %}
            </div>
        </div>
    </div>

    <!-- Mobile sidebar overlay -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden"></div>

    <script>
        // Mobile menu functionality
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');




        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');

        function toggleSidebar() {
            if (window.innerWidth < 1024) {
                sidebar.classList.toggle('sidebar-hidden');
                sidebarOverlay.classList.toggle('hidden');
            }
        }

        mobileMenuBtn.addEventListener('click', toggleSidebar);
        sidebarOverlay.addEventListener('click', toggleSidebar);

        // Handle window resize to manage sidebar visibility
        window.addEventListener('resize', function () {
            if (window.innerWidth >= 1024) {
                // Desktop view - ensure sidebar is visible and overlay is hidden
                sidebar.classList.remove('sidebar-hidden');
                sidebarOverlay.classList.add('hidden');
            } else {
                // Mobile view - hide sidebar by default
                if (!sidebar.classList.contains('sidebar-hidden')) {
                    sidebar.classList.add('sidebar-hidden');
                    sidebarOverlay.classList.add('hidden');
                }
            }
        });

        // Initialize sidebar state on page load
        if (window.innerWidth < 1024) {
            sidebar.classList.add('sidebar-hidden');
        }

        // Flash message system
        function showFlashMessage(message, type) {
            const container = document.getElementById('flash-messages');
            const messageDiv = document.createElement('div');

            let bgColor = 'bg-gray-700';
            if (type === 'success') bgColor = 'bg-green-600';
            else if (type === 'error') bgColor = 'bg-red-600';
            else if (type === 'warning') bgColor = 'bg-yellow-500';
            else if (type === 'info') bgColor = 'bg-indigo-600';

            messageDiv.className = `rounded-xl p-4 text-sm font-medium text-white ${bgColor} transform transition-all duration-300 ease-out opacity-0 translate-y-[-20px]`;
            messageDiv.textContent = message;

            container.appendChild(messageDiv);

            // Animate in
            setTimeout(() => {
                messageDiv.classList.remove('opacity-0', 'translate-y-[-20px]');
            }, 100);

            // Remove after 5 seconds
            setTimeout(() => {
                messageDiv.classList.add('opacity-0', 'translate-y-[-20px]');
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.parentNode.removeChild(messageDiv);
                    }
                }, 300);
            }, 5000);
        }

        // Auto-hide flash messages
        setTimeout(() => {
            const flashMessages = document.querySelectorAll('#flash-messages > div');
            flashMessages.forEach(msg => {
                msg.classList.add('opacity-0', 'translate-y-[-20px]');
                setTimeout(() => {
                    if (msg.parentNode) {
                        msg.parentNode.removeChild(msg);
                    }
                }, 300);
            });
        }, 5000);
    </script>
</body>

</html>
